<section data-bind="if: stats" class="stats content-margin">
    <h2 class="on-base-background">General Database Stats
        <a target="_blank" href="#" title="Show raw output" data-bind="attr: { href: rawJsonUrl }"><i class="icon-link"></i></a>
        <button class="btn btn-primary pull-right" data-bind="click: refreshStats" title="Click to refresh stats">
            <i class="icon-refresh"></i><span>Refresh</span>
        </button>
    </h2>
    <hr />
    <div id="storage-report">
        <div class="base-path">
            <i class="icon-folder"></i>
            <span class="small" data-bind="text: dataLocation" title="Base path for database data files"></span>
        </div>
    </div>
    <div class="stats-list panel" data-bind="with: stats">
        <div class="row">
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-database-id"></i> <span>Database ID</span></div>
                    <div class="value long"><span data-bind="text: databaseId"></span></div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item js-size-tooltip">
                    <div class="name"><i class="icon-storage"></i><span>Size On Disk</span></div>
                    <div class="value"><span data-bind="text: totalSizeOnDisk"></span></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-etag"></i> <span>Last Document Etag</span></div>
                    <div class="value"><span data-bind="text: lastDocEtag"></span></div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-server"></i><span>Architecture</span></div>
                    <div class="value"><span data-bind="visible: is64Bit">64 Bit</span><span data-bind="visible : !is64Bit">32 Bit</span></div>
                </div>
            </div> 
        </div>
        <div class="row">
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-etag"></i> <span>Last Database Etag</span></div>
                    <div class="value"><span data-bind="text: lastDatabaseEtag"></span></div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item js-cv-tooltip">
                    <div class="name"><i class="icon-vector"></i><span>Database Change Vector</span></div>
                    <div class="value">
                        <span data-bind="foreach: databaseChangeVector">
                            <span class="badge badge-default" data-bind="text: shortFormat"></span>
                        </span>
                        <span data-bind="visible: databaseChangeVector.length === 0">Not yet defined</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-documents"></i> <span>Documents Count</span></div>
                    <div class="value"><span data-bind="text: countOfDocuments"></span></div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-new-counter"></i><span>Counters Count</span></div>
                    <div class="value"><span data-bind="text: countOfCounters"></span></div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-identities"></i><span>Identities Count</span></div>
                    <div class="value"><span data-bind="text: countOfIdentities"></span></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-indexing"></i><span>Indexes Count</span></div>
                    <div class="value"><span data-bind="text: countOfIndexes"></span></div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-revisions"></i><span>Revisions Count</span></div>
                    <div class="value"><span data-bind="text: countOfRevisions"></span></div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-conflicts"></i><span>Conflicts Count</span></div>
                    <div class="value"><span data-bind="text: countOfDocumentsConflicts"></span></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-attachment"></i><span>Attachments Count</span></div>
                    <div class="value">
                        <span data-bind="text: countOfAttachments"></span>
                        <span data-bind="visible: countOfAttachments !== countOfUniqueAttachments" class="text-muted"> / </span>
                        <small data-bind="visible: countOfAttachments !== countOfUniqueAttachments">
                            <span class="text-muted" data-bind="text: countOfUniqueAttachments + ' unique'"></span>
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-cmp-xchg"></i><span>Compare Exchange Count</span></div>
                    <div class="value"><span data-bind="text: countOfCompareExchange"></span></div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-zombie"></i><span>Tombstones Count</span></div>
                    <div class="value"><span data-bind="text: countOfTombstones"></span></div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 col-lg-4 col-xl-3">
                <div class="stats-item">
                    <div class="name"><i class="icon-timeseries-settings"></i><span>Time Series Segments Count</span>
                        <span class="margin-left margin-left-sm js-timeseries-segments has-info-icon"><i class="icon-info text-info"></i></span>
                    </div>
                    <div class="value"><span data-bind="text: countOfTimeSeriesSegments"></span></div>
                </div>
            </div>
        </div>
    </div>
    <h2 class="on-base-background margin-top margin-top-lg">Indexes Stats</h2>
    <hr />
    <div class="row" data-bind="visible: stats().indexesByType().length === 0">
        <div class="col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3">
            <i class="icon-xl icon-empty-set text-muted"></i>
            <h2 class="text-center text-muted">No indexes have been created for this database.</h2>
        </div>
    </div>
    <div data-bind="foreach: stats().indexesByType">
        <h3 data-bind="text: indexType + ' Indexes'" class="on-base-background"></h3>
        <div class="row row-sm flex-row" data-bind="foreach: indexes">
            <div class="col-sm-6 col-lg-4 col-xl-3 flex-vertical">
                <div class="stats-list panel flex-grow">
                    <div class="flex-horizontal title">
                        <h3 class="flex-grow text-elipsis">
                            <a href="#" data-bind="attr: { href: $root.urlForIndexPerformance(indexName), title: indexName } ">
                                <span class="text" data-bind="text: indexName"></span>
                            </a>
                        </h3>
                        <a href="#" title="Show stale reason" class=" pull-right flex-noshrink badge badge-warning"
                           data-bind="visible: isStale, click: _.partial($root.showStaleReasons, indexName)">
                            Stale
                        </a>
                    </div>
                    <div class="stats-item" data-bind="visible: !isFaultyIndex, if: !isFaultyIndex">
                        <div class="name">Entries Count:</div>
                        <div class="value" data-bind="text: entriesCount"></div>
                    </div>
                    <div class="stats-item" data-bind="visible: errorsCount > 0,if: errorsCount > 0">
                        <div class="name">Errors Count:</div>
                        <div class="value" data-bind="text: errorsCount"></div>
                    </div>
                    <div class="stats-item" data-bind="visible: !isFaultyIndex, if: !isFaultyIndex">
                        <div class="name">Map Attempts:</div>
                        <div class="value" data-bind="text: mapAttempts"></div>
                    </div>
                    <div class="stats-item" data-bind="visible: !isFaultyIndex, if: !isFaultyIndex">
                        <div class="name">Map Successes:</div>
                        <div class="value" data-bind="text: mapSuccesses"></div>
                    </div>
                    <div class="stats-item" data-bind="visible: mapErrors > 0, if: mapErrors > 0">
                        <div class="name">Map Errors:</div>
                        <div class="value" data-bind="text: mapErrors"></div>
                    </div>
                    <div data-bind="if: showMapReferenceSection">
                        <div class="stats-item" data-bind="visible: !isFaultyIndex, if: !isFaultyIndex">
                            <div class="name">Map Reference Attempts:</div>
                            <div class="value" data-bind="text: mapReferenceAttempts"></div>
                        </div>
                        <div class="stats-item" data-bind="visible: !isFaultyIndex, if: !isFaultyIndex">
                            <div class="name">Map Reference Successes:</div>
                            <div class="value" data-bind="text: mapReferenceSuccesses"></div>
                        </div>
                        <div class="stats-item" data-bind="visible: mapReferenceErrors > 0, if: mapReferenceErrors > 0">
                            <div class="name">Map Reference Errors:</div>
                            <div class="value" data-bind="text: mapReferenceErrors"></div>
                        </div>
                    </div>
                    <div class="stats-item" data-bind="visible: mappedPerSecondRate > 1, if: mappedPerSecondRate > 1">
                        <div class="name">Mapped Per Second Rate:</div>
                        <div class="value" data-bind="text: mappedPerSecondRateStr"></div>
                    </div>
                    <div class="stats-item" data-bind="visible: isReduceIndex, if: isReduceIndex">
                        <div class="name">Reduce Attempts:</div>
                        <div class="value" data-bind="text: reduceAttempts"></div>
                    </div>
                    <div class="stats-item" data-bind="visible: isReduceIndex, if: isReduceIndex">
                        <div class="name">Reduce Successes:</div>
                        <div class="value" data-bind="text: reduceSuccesses"></div>
                    </div>
                    <div class="stats-item" data-bind="visible: isReduceIndex && reduceErrors > 0, if: isReduceIndex && reduceErrors > 0">
                        <div class="name">Reduce Errors:</div>
                        <div class="value" data-bind="text: reduceErrors"></div>
                    </div>
                    <div class="stats-item" data-bind="visible: isReduceIndex && (reducedPerSecondRate > 1), if: isReduceIndex && (reducedPerSecondRate > 1)">
                        <div class="name">Reduced Per Second Rate:</div>
                        <div class="value" data-bind="text: reducedPerSecondRateStr"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
